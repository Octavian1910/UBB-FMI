     1                                  bits 32
     2                                  global start
     3                                  
     4                                  extern exit, fopen, fread, printf,fclose
     5                                  import exit  msvcrt.dll
     6                                  import fopen msvcrt.dll
     7                                  import fread msvcrt.dll
     8                                  import fclose msvcrt.dll
     9                                  
    10                                  import printf msvcrt.dll 
    11                                  
    12                                  ; Se da un fisier text. Sa se citeasca continutul fisierului, sa se contorizeze numarul de vocale si sa se afiseze aceasta valoare. Numele fisierului text este definit in segmentul de date.
    13                                  
    14                                  segment data use32 class=data
    15 00000000 696E7075742E747874-         nume_fisier db "input.txt",0
    15 00000009 00                 
    16 0000000A 7200                        mod_acces   db "r",0
    17                                  
    18 0000000C 00<rept>                    buffer      times 256 db 0   ; unde citim
    19 0000010C 00000000                    file_ptr    dd 0             ; pointer FILE*
    20                                      
    21 00000110 6165696F754145494F-         vocale db "aeiouAEIOU",0
    21 00000119 5500               
    22                                      len_vocale equ $-vocale
    23 0000011B 00000000                    lena dd 0
    24                                      
    25 0000011F 00000000                    rezultat dd 0
    26 00000123 496E20736972207375-         format db "In sir sunt %d consoane "  , 0
    26 0000012C 6E7420256420636F6E-
    26 00000135 736F616E652000     
    27                                  
    28                                  segment code use32 class=code
    29                                  start:
    30                                  
    31                                      ; -------------------------
    32                                      ; DESCHIDEREA FIȘIERULUI
    33                                      ; FILE * fopen(nume_fisier, mod_acces)
    34                                      ; -------------------------
    35 00000000 68[0A000000]                push dword mod_acces
    36 00000005 68[00000000]                push dword nume_fisier
    37 0000000A FF15[00000000]              call [fopen]
    38 00000010 83C408                      add  esp, 4*2
    39                                  
    40 00000013 A3[0C010000]                mov [file_ptr], eax      ; FILE* returnat de fopen  descriptor
    41                                  
    42 00000018 83F800                      cmp eax, 0               ; dacă fopen a eșuat
    43 0000001B 747B                        je finish
    44                                  
    45                                  
    46                                      ; -------------------------
    47                                      ; CITIREA DIN FIȘIER
    48                                      ; fread(buffer, 1, 256, file_ptr)
    49                                      ; -------------------------
    50 0000001D FF35[0C010000]              push dword [file_ptr]    ; stream
    51 00000023 6800010000                  push dword 256           ; count
    52 00000028 6A01                        push dword 1             ; size
    53 0000002A 68[0C000000]                push dword buffer        ; pointer buffer
    54 0000002F FF15[00000000]              call [fread]
    55 00000035 83C410                      add esp, 16              ; curățăm stiva
    56                                  
    57 00000038 83F800                      cmp eax,0   ; in eax returneaza cate elemente sunt in buffer
    58 0000003B 745B                        je finish
    59                                      ; acum textul din fișier este în `buffer`
    60                                      
    61 0000003D A3[1B010000]                mov [lena],eax  ; lena= lungimea a
    62                                      
    63 00000042 8B0D[1B010000]              mov ecx,[lena]
    64 00000048 BE00000000                  mov esi,0
    65                                      
    66                                      loop_buffer:
    67 0000004D 8A86[0C000000]                  mov al,[buffer + esi]
    68 00000053 BF00000000                      mov edi,0
    69                                          verif_carac :
    70 00000058 8A9F[10010000]                      mov bl,[vocale + edi]
    71 0000005E 80FB00                              cmp bl,0
    72 00000061 7409                                je contorizare ;daca a ajuns la 0 din vocale 
    73                                              
    74 00000063 38D8                                cmp al,bl
    75 00000065 740B                                je final_loop_buffer
    76                                              
    77 00000067 47                                  inc edi
    78 00000068 EBEE                            jmp verif_carac
    79                                          
    80 0000006A EB06                            jmp final_loop_buffer
    81                                          contorizare :
    82 0000006C FF05[1F010000]                     inc dword [rezultat]
    83                                           
    84                                          final_loop_buffer : 
    85 00000072 46                              inc esi 
    86 00000073 E2D8                         loop loop_buffer
    87                                            
    88                                            
    89                                         ;printf(format,rezultat)
    90 00000075 FF35[1F010000]                 push dword [rezultat]
    91 0000007B 68[23010000]                   push format
    92 00000080 FF15[00000000]                 call [printf]
    93 00000086 83C408                         add esp,4*2    
    94                                              
    95                                          ; apelam functia fclose pentru a inchide fisierul
    96                                          ; fclose(descriptor_fis)
    97 00000089 FF35[0C010000]                  push dword [file_ptr]
    98 0000008F FF15[00000000]                  call [fclose]
    99 00000095 83C404                          add esp, 4
   100                                  
   101                                  finish:
   102 00000098 6A00                        push dword 0
   103 0000009A FF15[00000000]              call [exit]
